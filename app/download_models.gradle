/*
 * Copyright 2022 The TensorFlow Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *             http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

task downloadMobileBertModel(type: Download) {
    src 'https://storage.googleapis.com/mediapipe-models/text_embedder/bert_embedder/float32/1/bert_embedder.tflite'
    dest project.ext.ASSET_DIR + '/mobile_bert.tflite'
    overwrite false
}

task downloadAverageWordModel(type: Download) {
    src 'https://storage.googleapis.com/mediapipe-models/text_embedder/average_word_embedder/float32/1/average_word_embedder.tflite'
    dest project.ext.ASSET_DIR + '/average_word.tflite'
    overwrite false
}

task downloadQwenModel(type: Download) {
    src 'https://huggingface.co/litert-community/Qwen2.5-1.5B-Instruct/resolve/main/Qwen2.5-1.5B-Instruct_multi-prefill-seq_q8_ekv1280.task'
    dest project.ext.ASSET_DIR + '/Qwen2.5-1.5B-Instruct_multi-prefill-seq_q8_ekv1280.task'
    overwrite false

    // Set a longer timeout for this large file
    connectTimeout 60000  // 60 seconds
    readTimeout 300000    // 5 minutes

    // Add a progress listener for large downloads
    doLast {
        println "Downloaded Qwen2.5 LLM model to assets directory"
    }
}

preBuild.dependsOn downloadMobileBertModel, downloadAverageWordModel, downloadQwenModel
